<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:EcoBank.App.ViewModels.Auth"
             xmlns:domain="using:EcoBank.Core.Domain.Users"
             x:Class="EcoBank.App.Views.Auth.UserSelectionView"
             x:DataType="vm:UserSelectionViewModel">

  <DockPanel>
    <!-- Header -->
    <Border DockPanel.Dock="Top" Padding="16,12" BoxShadow="0 1 4 0 #10000000">
      <Grid ColumnDefinitions="Auto,*,Auto">
        <Button Grid.Column="0"
                Classes="Secondary"
                Content="â† Changer de credentials"
                Command="{Binding ChangeCredentialsCommand}"
                VerticalAlignment="Center"/>
        <TextBlock Grid.Column="1"
                   Text="SÃ©lection de l'utilisateur"
                   FontSize="20"
                   FontWeight="SemiBold"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"/>
      </Grid>
    </Border>

    <!-- Search bar -->
    <Border DockPanel.Dock="Top" Padding="16,8">
      <TextBox Classes="EcoField"
               Text="{Binding SearchQuery}"
               Watermark="ðŸ”  Rechercher un utilisateur..."
               AutomationProperties.Name="Recherche utilisateur"/>
    </Border>

    <!-- Loading -->
    <ProgressBar DockPanel.Dock="Top"
                 IsIndeterminate="True"
                 Height="3"
                 IsVisible="{Binding IsBusy}"/>

    <!-- Error -->
    <Border DockPanel.Dock="Top"
            Background="#FEE2E2"
            Padding="16,10"
            IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
      <TextBlock Text="{Binding ErrorMessage}" Foreground="#B91C1C" TextWrapping="Wrap"/>
    </Border>

    <!-- Empty state -->
    <StackPanel DockPanel.Dock="Top"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Spacing="12"
                Margin="32"
                IsVisible="{Binding IsEmpty}">
      <TextBlock Text="ðŸ‘¤" FontSize="48" HorizontalAlignment="Center"/>
      <TextBlock Text="Aucun utilisateur trouvÃ©"
                 FontSize="18"
                 FontWeight="SemiBold"
                 HorizontalAlignment="Center"/>
      <TextBlock Text="VÃ©rifiez vos credentials ou essayez une autre recherche."
                 Foreground="#6B7280"
                 TextWrapping="Wrap"
                 HorizontalAlignment="Center"
                 TextAlignment="Center"/>
    </StackPanel>

    <!-- User list -->
    <ListBox ItemsSource="{Binding Users}"
             SelectionMode="Single">
      <ListBox.ItemTemplate>
        <DataTemplate x:DataType="domain:User">
          <Button Classes="NavItem"
                  HorizontalAlignment="Stretch"
                  Command="{Binding $parent[ListBox].((vm:UserSelectionViewModel)DataContext).SelectUserCommand}"
                  CommandParameter="{Binding}">
            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto" Margin="4">
              <TextBlock Grid.Row="0" Grid.Column="0"
                         FontWeight="SemiBold"
                         FontSize="15">
                <TextBlock.Text>
                  <MultiBinding StringFormat="{}{0} {1}">
                    <Binding Path="FirstName"/>
                    <Binding Path="LastName"/>
                  </MultiBinding>
                </TextBlock.Text>
              </TextBlock>
              <TextBlock Grid.Row="1" Grid.Column="0"
                         Text="{Binding AppUserId}"
                         FontSize="13"
                         Foreground="#6B7280"/>
              <Border Grid.Row="0" Grid.Column="1" Grid.RowSpan="2"
                      Classes="BadgeSuccess"
                      VerticalAlignment="Center">
                <TextBlock Text="{Binding KycStatus}"
                           FontSize="11"
                           FontWeight="Medium"/>
              </Border>
            </Grid>
          </Button>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>
  </DockPanel>
</UserControl>
