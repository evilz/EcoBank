<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:EcoBank.App.ViewModels.Home"
             xmlns:ops="using:EcoBank.Core.Domain.Operations"
             xmlns:ic="using:IconPacks.Avalonia.Material"
             x:Class="EcoBank.App.Views.Home.HomeView"
             x:DataType="vm:HomeViewModel"
             Background="#F7F8F5">

  <ScrollViewer VerticalScrollBarVisibility="Auto">
    <StackPanel Margin="20,24,20,32" Spacing="0">

      <!-- ═══════════════════════════════════════
           HEADER : Bonjour [Prénom] + Cloche
           ═══════════════════════════════════════ -->
      <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,28">
        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
          <TextBlock Text="{Binding WelcomeMessage}"
                     FontSize="28"
                     FontWeight="Bold"
                     Foreground="#1B1D1F"
                     VerticalAlignment="Center"/>
          <ic:PackIconMaterial Kind="ChevronDown"
                               Width="20" Height="20"
                               Foreground="#1B1D1F"
                               VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Cloche avec badge rouge -->
        <Button Grid.Column="1"
                Classes="BellButton"
                VerticalAlignment="Center"
                HorizontalAlignment="Right">
          <Panel>
            <Border Width="48" Height="48"
                    CornerRadius="24"
                    Background="#EEF0EB">
              <ic:PackIconMaterial Kind="Bell"
                                   Width="22" Height="22"
                                   Foreground="#1B1D1F"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
            </Border>
            <!-- Badge rouge notification -->
            <Ellipse Width="10" Height="10"
                     Fill="#E53935"
                     HorizontalAlignment="Right"
                     VerticalAlignment="Top"
                     Margin="0,4,4,0"/>
          </Panel>
        </Button>
      </Grid>

      <!-- ═══════════════════════════════════════
           ONGLETS : Comptes (actif) / Épargne / Crédits / Assurances
           ═══════════════════════════════════════ -->
      <ScrollViewer HorizontalScrollBarVisibility="Auto"
                    VerticalScrollBarVisibility="Disabled"
                    Margin="0,0,0,24">
        <StackPanel Orientation="Horizontal" Spacing="4">
          <!-- Comptes - actif -->
          <Button Classes="TabActive">
            <TextBlock Text="Comptes" FontSize="15" FontWeight="SemiBold"/>
          </Button>
          <!-- Épargne - inactif (placeholder) -->
          <Button Classes="TabInactive" IsEnabled="False">
            <TextBlock Text="Épargne" FontSize="15"/>
          </Button>
          <!-- Crédits - inactif (placeholder) -->
          <Button Classes="TabInactive" IsEnabled="False">
            <TextBlock Text="Crédits" FontSize="15"/>
          </Button>
          <!-- Assurances - inactif (placeholder) -->
          <Button Classes="TabInactive" IsEnabled="False">
            <TextBlock Text="Assurances" FontSize="15"/>
          </Button>
        </StackPanel>
      </ScrollViewer>

      <!-- ═══════════════════════════════════════
           BLOC SOLDE TOTAL
           ═══════════════════════════════════════ -->
      <Grid ColumnDefinitions="*,Auto,Auto" Margin="0,0,0,6">
        <TextBlock Grid.Column="0"
                   Text="Total comptes personnalisé"
                   FontSize="13"
                   Foreground="#5A6A5A"
                   VerticalAlignment="Center"/>
        <Button Grid.Column="1"
                Classes="IconBtn"
                Command="{Binding ToggleBalanceCommand}"
                ToolTip.Tip="Afficher / masquer le solde">
          <ic:PackIconMaterial Kind="{Binding IsBalanceVisible, Converter={x:Static vm:BoolToEyeIconConverter.Instance}}"
                               Width="20" Height="20"
                               Foreground="#1B1D1F"/>
        </Button>
        <Button Grid.Column="2" Classes="IconBtn">
          <ic:PackIconMaterial Kind="DotsVertical" Width="20" Height="20" Foreground="#1B1D1F"/>
        </Button>
      </Grid>

      <!-- Montant total masquable -->
      <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,28">
        <Border Width="36" Height="22"
                CornerRadius="4"
                Background="#1B1D1F"
                IsVisible="{Binding !IsBalanceVisible}"/>
        <TextBlock FontSize="28" FontWeight="Bold" Foreground="#1B1D1F"
                   IsVisible="{Binding IsBalanceVisible}">
          <TextBlock.Text>
            <MultiBinding StringFormat="{}{0:N2} €">
              <Binding Path="TotalBalance"/>
            </MultiBinding>
          </TextBlock.Text>
        </TextBlock>
        <TextBlock Text="••••• €"
                   FontSize="28" FontWeight="Bold" Foreground="#1B1D1F"
                   VerticalAlignment="Center"
                   IsVisible="{Binding !IsBalanceVisible}"/>
      </StackPanel>

      <!-- ═══════════════════════════════════════
           CARTE COMPTE DE DÉPÔT
           ═══════════════════════════════════════ -->
      <Border Classes="Card" Margin="0,0,0,12">
        <StackPanel Spacing="0">

          <!-- Titre + Solde courant -->
          <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,4">
            <TextBlock Grid.Column="0"
                       Text="{Binding FirstAccountLabel}"
                       FontSize="17"
                       FontWeight="Bold"
                       Foreground="#1B1D1F"
                       VerticalAlignment="Center"/>
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
              <Border Width="28" Height="18"
                      CornerRadius="3"
                      Background="#1B1D1F"
                      IsVisible="{Binding !IsBalanceVisible}"/>
              <TextBlock FontSize="17" FontWeight="Bold" Foreground="#1E7F4F"
                         IsVisible="{Binding IsBalanceVisible}">
                <TextBlock.Text>
                  <MultiBinding StringFormat="{}{0:N2} €">
                    <Binding Path="FirstAccountBalance"/>
                  </MultiBinding>
                </TextBlock.Text>
              </TextBlock>
            </StackPanel>
          </Grid>

          <!-- Numéro de compte + Solde à venir -->
          <Grid ColumnDefinitions="*,Auto">
            <TextBlock Grid.Column="0"
                       Text="{Binding FirstAccountNumber}"
                       FontSize="13"
                       Foreground="#5A8A6A"/>
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
              <TextBlock Text="Solde à venir :"
                         FontSize="12"
                         Foreground="#5A6A5A"/>
              <Border Width="24" Height="14"
                      CornerRadius="2"
                      Background="#1B1D1F"
                      IsVisible="{Binding !IsBalanceVisible}"/>
              <TextBlock FontSize="12" FontWeight="SemiBold" Foreground="#1E7F4F"
                         IsVisible="{Binding IsBalanceVisible}">
                <TextBlock.Text>
                  <MultiBinding StringFormat="{}{0:N2} €">
                    <Binding Path="UpcomingBalance"/>
                  </MultiBinding>
                </TextBlock.Text>
              </TextBlock>
            </StackPanel>
          </Grid>

          <!-- Séparateur -->
          <Border Height="1" Background="#EBEBEB" Margin="0,16,0,12"/>

          <!-- Loader -->
          <TextBlock Text="Chargement…"
                     FontSize="13" Foreground="#9A9A9A"
                     HorizontalAlignment="Center"
                     IsVisible="{Binding IsBusy}"/>

          <!-- Erreur -->
          <TextBlock Text="{Binding ErrorMessage}"
                     Foreground="#FF4D4F"
                     TextWrapping="Wrap"
                     IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

          <!-- Liste des 3 dernières transactions -->
          <ItemsControl ItemsSource="{Binding RecentOperations}">
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="ops:Operation">
                <Grid ColumnDefinitions="Auto,*,Auto"
                      ColumnSpacing="12"
                      Margin="0,0,0,14">

                  <!-- Avatar coloré selon catégorie -->
                  <Border Grid.Column="0"
                          Width="40" Height="40"
                          CornerRadius="20"
                          Background="{Binding Category, Converter={x:Static vm:CategoryToColorConverter.Instance}}"
                          VerticalAlignment="Center">
                    <ic:PackIconMaterial
                        Kind="{Binding Category, Converter={x:Static vm:CategoryToIconConverter.Instance}}"
                        Width="18" Height="18"
                        Foreground="White"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"/>
                  </Border>

                  <!-- Label -->
                  <TextBlock Grid.Column="1"
                             Text="{Binding Label}"
                             FontSize="14"
                             FontWeight="Medium"
                             Foreground="#1B1D1F"
                             VerticalAlignment="Center"
                             TextTrimming="CharacterEllipsis"/>

                  <!-- Montant -->
                  <TextBlock Grid.Column="2"
                             FontSize="14"
                             FontWeight="SemiBold"
                             VerticalAlignment="Center">
                    <TextBlock.Text>
                      <MultiBinding StringFormat="{}{0:+#,##0.00;-#,##0.00} €">
                        <Binding Path="Amount"/>
                      </MultiBinding>
                    </TextBlock.Text>
                    <TextBlock.Foreground>
                      <Binding Path="Amount" Converter="{x:Static vm:AmountToColorConverter.Instance}"/>
                    </TextBlock.Foreground>
                  </TextBlock>
                </Grid>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>

        </StackPanel>
      </Border>

      <!-- ═══════════════════════════════════════
           QUICK ACTIONS : RIB / Cartes / Wero / Budget
           ═══════════════════════════════════════ -->
      <Border Classes="Card" Margin="0,0,0,0">
        <UniformGrid Columns="4" ColumnSpacing="8">

          <!-- RIB -->
          <Button Classes="QuickAction">
            <StackPanel Spacing="8" HorizontalAlignment="Center">
              <Border Classes="QuickActionIcon">
                <ic:PackIconMaterial Kind="FileDocumentOutline"
                                     Width="24" Height="24"
                                     Foreground="#1A7F4F"/>
              </Border>
              <TextBlock Text="RIB" FontSize="12" FontWeight="Medium"
                         HorizontalAlignment="Center" Foreground="#1B1D1F"/>
            </StackPanel>
          </Button>

          <!-- Cartes -->
          <Button Classes="QuickAction">
            <StackPanel Spacing="8" HorizontalAlignment="Center">
              <Border Classes="QuickActionIcon">
                <ic:PackIconMaterial Kind="CreditCardOutline"
                                     Width="24" Height="24"
                                     Foreground="#1A7F4F"/>
              </Border>
              <TextBlock Text="Cartes" FontSize="12" FontWeight="Medium"
                         HorizontalAlignment="Center" Foreground="#1B1D1F"/>
            </StackPanel>
          </Button>

          <!-- Wero -->
          <Button Classes="QuickAction">
            <StackPanel Spacing="8" HorizontalAlignment="Center">
              <Border Classes="QuickActionIcon">
                <ic:PackIconMaterial Kind="SendOutline"
                                     Width="24" Height="24"
                                     Foreground="#1A7F4F"/>
              </Border>
              <TextBlock Text="Wero" FontSize="12" FontWeight="Medium"
                         HorizontalAlignment="Center" Foreground="#1B1D1F"/>
            </StackPanel>
          </Button>

          <!-- Budget -->
          <Button Classes="QuickAction">
            <StackPanel Spacing="8" HorizontalAlignment="Center">
              <Border Classes="QuickActionIcon">
                <ic:PackIconMaterial Kind="ChartPie"
                                     Width="24" Height="24"
                                     Foreground="#1A7F4F"/>
              </Border>
              <TextBlock Text="Budget" FontSize="12" FontWeight="Medium"
                         HorizontalAlignment="Center" Foreground="#1B1D1F"/>
            </StackPanel>
          </Button>

        </UniformGrid>
      </Border>

    </StackPanel>
  </ScrollViewer>
</UserControl>
